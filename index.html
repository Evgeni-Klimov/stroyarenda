<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерактивный бизнес-план: Прокат инструмента в Архангельске</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A single-page dashboard with tab-based navigation for easy access to key sections: Summary, Market Analysis, Financial Model, Operations, and Insurance. This structure is chosen for its clarity and user-friendliness, allowing a potential investor or owner to quickly navigate to the information they need without overwhelming scrolling. The core of the application is the interactive Financial Model, enabling users to adjust key variables and immediately see the impact, which is the most effective way to explore the business's potential. -->
    <!-- Visualization & Content Choices: 
        - Initial Investment: Goal: Inform. Viz: Donut Chart. Interaction: Hover for details. Justification: Clearly shows the proportion of startup costs. Library: Chart.js.
        - Financial Projections: Goal: Compare & Analyze Change. Viz: Combined Bar (Revenue/Costs) and Line (Profit) Chart. Interaction: Sliders to change assumptions update the chart dynamically. Justification: Provides a comprehensive, interactive view of the financial viability over time. Library: Chart.js.
        - Payback Period: Goal: Analyze Change. Viz: Line Chart showing cumulative profit. Interaction: Dynamically updated by financial sliders. Justification: Visualizes the key investment metric—time to profitability. Library: Chart.js.
        - Operational Workflow & Insurance Model: Goal: Organize. Viz: Styled HTML/CSS diagrams. Interaction: Static. Justification: Clearly explains complex processes without requiring complex visualizations, focusing on readability. Method: Tailwind CSS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #383838;
        }
        .tab-active {
            border-bottom-color: #C5A07A;
            color: #C5A07A;
            font-weight: 600;
        }
        .tab-inactive {
            border-bottom-color: transparent;
            color: #6B7280;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .card {
            background-color: #FFFFFF;
            border: 1px solid #F0E9E1;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #E5E7EB;
            border-radius: 5px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #C5A07A;
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #C5A07A;
            cursor: pointer;
            border-radius: 50%;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-gray-800">Бизнес по прокату инструмента</h1>
            <p class="text-xl text-gray-500 mt-2">Интерактивная финансовая модель и бизнес-план для г. Архангельск</p>
        </header>

        <div class="border-b border-gray-200 mb-8">
            <nav class="flex justify-center -mb-px space-x-6">
                <button data-tab="summary" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-active">Резюме проекта</button>
                <button data-tab="market" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-inactive">Анализ рынка</button>
                <button data-tab="finance" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-inactive">Финансовая модель</button>
                <button data-tab="operations" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-inactive">Операционный план</button>
                <button data-tab="insurance" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-inactive">Работа со страховой</button>
            </nav>
        </div>

        <main>
            <section id="summary" class="content-section active">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-gray-700">Ключевые аспекты проекта</h2>
                    <p class="text-gray-600 mb-6">Этот раздел представляет собой краткий обзор всего бизнес-плана. Здесь собраны основные цели, миссия компании и ключевые финансовые показатели, которые дают общее представление о потенциале и структуре бизнеса по аренде строительного и ремонтного инструмента в Архангельске.</p>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="p-6 bg-amber-50 rounded-lg">
                            <h3 class="font-semibold text-lg text-amber-800">Миссия</h3>
                            <p class="text-amber-700 mt-2">Предоставить жителям и малому бизнесу Архангельска доступ к качественному профессиональному инструменту без необходимости его покупки, экономя их деньги и время.</p>
                        </div>
                        <div class="p-6 bg-blue-50 rounded-lg">
                            <h3 class="font-semibold text-lg text-blue-800">Цели проекта</h3>
                            <ul class="list-disc list-inside text-blue-700 mt-2 space-y-1">
                                <li>Занять 15% рынка аренды инструмента в городе в течение 2 лет.</li>
                                <li>Достичь точки безубыточности в течение 8-10 месяцев.</li>
                                <li>Сформировать базу из 500+ постоянных клиентов за первый год.</li>
                                <li>Обеспечить полную окупаемость инвестиций за 18-24 месяца.</li>
                            </ul>
                        </div>
                        <div class="p-6 bg-green-50 rounded-lg">
                            <h3 class="font-semibold text-lg text-green-800">Ключевые показатели (прогноз)</h3>
                            <div class="mt-2 space-y-2 text-green-700">
                                <p><strong>Инвестиции:</strong> <span id="summary_invest">850 000</span> ₽</p>
                                <p><strong>Срок окупаемости:</strong> <span id="summary_payback">21</span> мес.</p>
                                <p><strong>Средняя рентабельность:</strong> 25-30%</p>
                            </div>
                        </div>
                    </div>
                     <div class="mt-8">
                        <h3 class="text-xl font-bold mb-4 text-gray-700">Структура стартовых инвестиций</h3>
                        <div class="chart-container h-64 md:h-80">
                            <canvas id="investmentChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <section id="market" class="content-section">
                 <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-gray-700">Анализ рынка и конкурентов в Архангельске</h2>
                    <p class="text-gray-600 mb-6">Понимание рыночной среды — ключ к успеху. В этом разделе мы анализируем целевую аудиторию, ее потребности, а также текущую конкурентную ситуацию в Архангельске. Это позволяет определить наши преимущества и разработать эффективную стратегию позиционирования.</p>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-semibold mb-3">Целевая аудитория</h3>
                            <div class="space-y-4">
                                <div class="p-4 bg-gray-50 rounded-lg">
                                    <h4 class="font-semibold">🏠 Частные лица (DIY-сегмент)</h4>
                                    <p class="text-sm text-gray-600">Люди, делающие ремонт в квартире или на даче. Нуждаются в инструменте на короткий срок (1-3 дня). Ценят простоту аренды и консультацию.</p>
                                </div>
                                <div class="p-4 bg-gray-50 rounded-lg">
                                    <h4 class="font-semibold">👷‍♂️ Профессиональные бригады</h4>
                                    <p class="text-sm text-gray-600">Небольшие строительные и ремонтные бригады. Арендуют специфический или дорогой инструмент под конкретный проект. Ценят надежность и широкий ассортимент.</p>
                                </div>
                                 <div class="p-4 bg-gray-50 rounded-lg">
                                    <h4 class="font-semibold">🏢 Юридические лица</h4>
                                    <p class="text-sm text-gray-600">Управляющие компании, event-агентства, производственные компании, которым инструмент нужен для разовых задач. Ценят безналичный расчет и документооборот.</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-3">Конкурентный анализ</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm">
                                    <thead class="bg-gray-100">
                                        <tr>
                                            <th class="p-3 font-medium">Критерий</th>
                                            <th class="p-3 font-medium text-center">Наш прокат</th>
                                            <th class="p-3 font-medium text-center">Конкурент 1</th>
                                            <th class="p-3 font-medium text-center">Конкурент 2</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="border-b">
                                            <td class="p-3">Ассортимент</td>
                                            <td class="p-3 text-center text-green-600 font-bold">Широкий, фокус на популярные модели</td>
                                            <td class="p-3 text-center">Средний</td>
                                            <td class="p-3 text-center">Узкий, строительный</td>
                                        </tr>
                                        <tr class="border-b">
                                            <td class="p-3">Ценообразование</td>
                                            <td class="p-3 text-center text-green-600 font-bold">Гибкое, скидки</td>
                                            <td class="p-3 text-center">Среднерыночное</td>
                                            <td class="p-3 text-center">Высокое</td>
                                        </tr>
                                        <tr class="border-b">
                                            <td class="p-3">Онлайн-бронирование</td>
                                            <td class="p-3 text-center text-green-600 font-bold">✅ Есть</td>
                                            <td class="p-3 text-center">❌ Нет</td>
                                            <td class="p-3 text-center">❌ Нет</td>
                                        </tr>
                                        <tr>
                                            <td class="p-3">Страхование инструмента</td>
                                            <td class="p-3 text-center text-green-600 font-bold">✅ Опционально</td>
                                            <td class="p-3 text-center">❌ Нет</td>
                                            <td class="p-3 text-center">❌ Нет</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="finance" class="content-section">
                <div class="card">
                     <h2 class="text-2xl font-bold mb-4 text-gray-700">Интерактивная финансовая модель</h2>
                    <p class="text-gray-600 mb-6">Это основной инструмент для оценки жизнеспособности бизнеса. Изменяйте значения в блоке "Параметры моделирования", чтобы увидеть, как разные сценарии влияют на доходы, расходы и, самое главное, на срок окупаемости ваших инвестиций. Графики и ключевые показатели ниже обновятся автоматически.</p>

                    <div class="bg-stone-50 p-6 rounded-lg border border-stone-200 mb-8">
                        <h3 class="text-xl font-semibold mb-4 text-stone-800">Параметры моделирования</h3>
                        <div class="grid md:grid-cols-3 gap-6">
                            <div>
                                <label for="initialInvestment" class="block font-medium text-sm text-gray-700">Первоначальные инвестиции, ₽</label>
                                <input type="range" id="initialInvestment" min="500000" max="1500000" value="850000" step="50000">
                                <div class="text-center font-bold text-lg text-stone-700 mt-2"><span id="initialInvestmentValue">850 000</span> ₽</div>
                            </div>
                            <div>
                                <label for="avgRentalsPerDay" class="block font-medium text-sm text-gray-700">Среднее кол-во аренд в день</label>
                                <input type="range" id="avgRentalsPerDay" min="3" max="15" value="7" step="1">
                                <div class="text-center font-bold text-lg text-stone-700 mt-2"><span id="avgRentalsPerDayValue">7</span></div>
                            </div>
                             <div>
                                <label for="avgCheck" class="block font-medium text-sm text-gray-700">Средний чек аренды, ₽</label>
                                <input type="range" id="avgCheck" min="500" max="1500" value="800" step="50">
                                <div class="text-center font-bold text-lg text-stone-700 mt-2"><span id="avgCheckValue">800</span> ₽</div>
                            </div>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-3 gap-4 text-center mb-8">
                        <div class="p-4 bg-green-100 rounded-lg">
                            <div class="text-sm text-green-800">Выручка за 1-й год</div>
                            <div id="totalRevenue" class="text-2xl font-bold text-green-900">1 411 200 ₽</div>
                        </div>
                        <div class="p-4 bg-red-100 rounded-lg">
                             <div class="text-sm text-red-800">Чистая прибыль за 1-й год</div>
                            <div id="netProfit" class="text-2xl font-bold text-red-900">487 200 ₽</div>
                        </div>
                        <div class="p-4 bg-blue-100 rounded-lg">
                             <div class="text-sm text-blue-800">Срок окупаемости</div>
                            <div id="paybackPeriod" class="text-2xl font-bold text-blue-900">21 мес.</div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-xl font-semibold mb-4 text-center">Финансовые потоки и окупаемость (прогноз на 24 мес.)</h3>
                        <div class="chart-container">
                            <canvas id="financialChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="operations" class="content-section">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-gray-700">Операционный план и Программное обеспечение</h2>
                     <p class="text-gray-600 mb-6">Эффективные операции — основа стабильного дохода. Здесь описаны ежедневные процессы, от приема заказа до возврата инструмента, а также рекомендованное программное обеспечение для автоматизации и контроля всех этапов работы. Правильно выстроенные процессы минимизируют риски и повышают лояльность клиентов.</p>
                    
                    <h3 class="text-xl font-semibold mb-3">Алгоритм работы с клиентом (скрипт)</h3>
                    <div class="relative pl-6">
                        <div class="absolute left-0 top-0 h-full w-0.5 bg-gray-200"></div>
                        <div class="relative mb-6">
                            <div class="absolute -left-[35px] top-1 w-8 h-8 bg-blue-500 rounded-full text-white flex items-center justify-center font-bold">1</div>
                            <h4 class="font-semibold">Бронирование</h4>
                            <p class="text-sm text-gray-600">Клиент обращается по телефону, через сайт или мессенджер. Менеджер уточняет наличие, консультирует, оформляет бронь в CRM, сообщает условия (залог, документы).</p>
                        </div>
                        <div class="relative mb-6">
                             <div class="absolute -left-[35px] top-1 w-8 h-8 bg-blue-500 rounded-full text-white flex items-center justify-center font-bold">2</div>
                            <h4 class="font-semibold">Выдача инструмента</h4>
                            <p class="text-sm text-gray-600">Клиент приходит в пункт выдачи. Менеджер проверяет паспорт, подписывает договор, принимает залог. Демонстрирует исправность инструмента, объясняет правила эксплуатации.</p>
                        </div>
                         <div class="relative mb-6">
                             <div class="absolute -left-[35px] top-1 w-8 h-8 bg-blue-500 rounded-full text-white flex items-center justify-center font-bold">3</div>
                            <h4 class="font-semibold">Возврат инструмента</h4>
                            <p class="text-sm text-gray-600">Клиент возвращает инструмент. Менеджер проверяет его комплектность и работоспособность. Если все в порядке — возвращает залог и подписывает акт возврата.</p>
                        </div>
                        <div class="relative">
                             <div class="absolute -left-[35px] top-1 w-8 h-8 bg-blue-500 rounded-full text-white flex items-center justify-center font-bold">4</div>
                            <h4 class="font-semibold">Обработка после возврата</h4>
                            <p class="text-sm text-gray-600">Инструмент очищается, проходит технический осмотр и готовится к следующей аренде. Статус в CRM меняется на "Свободен".</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-semibold mt-8 mb-3">Программное обеспечение</h3>
                     <p class="text-gray-600 mb-4">Для эффективного управления рекомендуется использовать специализированную CRM-систему для арендного бизнеса. Ключевые функции:</p>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-semibold">📦 Учет инвентаря</h4>
                            <p class="text-sm text-gray-600">Каталог инструмента с фото, описаниями, историей ремонтов и статусом (свободен, в аренде, в ремонте).</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-semibold">📅 Календарь бронирования</h4>
                            <p class="text-sm text-gray-600">Визуальное отображение занятости каждого инструмента, предотвращение двойного бронирования.</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-semibold">👥 Клиентская база (CRM)</h4>
                            <p class="text-sm text-gray-600">Ведение истории аренд по каждому клиенту, "черный список", система скидок для постоянных клиентов.</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-semibold">📄 Документооборот и финансы</h4>
                            <p class="text-sm text-gray-600">Автоматическое формирование договоров, актов, учет платежей, контроль залоговых сумм.</p>
                        </div>
                    </div>
                    <p class="mt-4 text-sm text-gray-500"><strong>Примеры ПО:</strong> RentProg, Booker, Booqable. Стоимость варьируется от 2000 до 5000 руб./месяц.</p>
                </div>
            </section>
            
            <section id="insurance" class="content-section">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4 text-gray-700">Взаимодействие со страховыми компаниями</h2>
                    <p class="text-gray-600 mb-6">Партнерство со страховой компанией — это не только способ защитить свои активы, но и уникальное конкурентное преимущество. Оно повышает доверие клиентов и создает дополнительный источник дохода. Здесь подробно описаны интересы обеих сторон и шаги по построению взаимовыгодного сотрудничества.</p>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-semibold mb-3">Интересы сторон</h3>
                            <div class="space-y-4">
                                <div>
                                    <h4 class="font-semibold text-blue-700">✔ Ваш интерес (прокат)</h4>
                                    <ul class="list-disc list-inside text-sm text-gray-600 mt-1 space-y-1">
                                        <li>Защита дорогостоящего инструмента от поломки и кражи.</li>
                                        <li>Снижение рисков при работе с новыми клиентами.</li>
                                        <li>Получение агентской комиссии с каждой проданной страховки (5-15%).</li>
                                        <li>Повышение лояльности клиентов за счет дополнительной услуги.</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-green-700">✔ Интерес страховой компании</h4>
                                    <ul class="list-disc list-inside text-sm text-gray-600 mt-1 space-y-1">
                                        <li>Выход на новый микро-рынок с большим потоком клиентов.</li>
                                        <li>Продажа коробочного, простого и низкоубыточного продукта.</li>
                                        <li>Минимальные затраты на привлечение клиента (выступаете как агент).</li>
                                        <li>Риски минимизированы вашими мерами: проверка клиента, залог, четкий договор.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-xl font-semibold mb-3">Алгоритм начала сотрудничества</h3>
                            <div class="space-y-4">
                                <p><strong>Шаг 1: Подготовка.</strong> Соберите статистику: среднее количество аренд в месяц, стоимость парка инструмента, типичные поломки.</p>
                                <p><strong>Шаг 2: Коммерческое предложение.</strong> Составьте КП для страховой, где опишите ваш бизнес, поток клиентов и предложение стать их агентом. Укажите, что вы берете на себя проверку клиентов и оформление.</p>
                                <p><strong>Шаг 3: Переговоры.</strong> Обратитесь в отделы по работе с партнерами нескольких крупных страховых компаний в Архангельске (например, Росгосстрах, Ингосстрах, СОГАЗ). Обсудите условия: размер страховой премии для клиента, ваш комиссионный процент, процедуру урегулирования убытков.</p>
                                <p><strong>Шаг 4: Интеграция.</strong> В идеале — добиться интеграции по API для автоматического оформления полисов. На старте — ручное оформление через личный кабинет агента. Включите опцию "Застраховать инструмент" в ваш договор аренды и на сайт.</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 bg-amber-50 p-6 rounded-lg border border-amber-200">
                        <h4 class="text-lg font-semibold text-amber-800">Пример продукта для клиента</h4>
                        <p class="text-amber-700 mt-2">Клиенту предлагается "Защита инструмента" за 10% от стоимости аренды. Например, при аренде на 1000 ₽, страховка стоит 100 ₽. Эта сумма покрывает случайные поломки на сумму до 15 000 ₽. Вы, как агент, получаете с этих 100 ₽ комиссию, например, 15 ₽. Это просто, выгодно всем и снимает головную боль как с вас, так и с клиента.</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const tabs = document.querySelectorAll('nav button');
    const sections = document.querySelectorAll('.content-section');
    const initialInvestmentSlider = document.getElementById('initialInvestment');
    const avgRentalsPerDaySlider = document.getElementById('avgRentalsPerDay');
    const avgCheckSlider = document.getElementById('avgCheck');
    const initialInvestmentValue = document.getElementById('initialInvestmentValue');
    const avgRentalsPerDayValue = document.getElementById('avgRentalsPerDayValue');
    const avgCheckValue = document.getElementById('avgCheckValue');

    const summaryInvest = document.getElementById('summary_invest');
    const summaryPayback = document.getElementById('summary_payback');
    const totalRevenueEl = document.getElementById('totalRevenue');
    const netProfitEl = document.getElementById('netProfit');
    const paybackPeriodEl = document.getElementById('paybackPeriod');

    let investmentChart, financialChart;

    const formatCurrency = (value) => new Intl.NumberFormat('ru-RU').format(Math.round(value));

    const initialData = {
        investment: 850000,
        rentalsPerDay: 7,
        avgCheck: 800,
    };

    const costStructure = {
        rent: 40000, 
        salary: 45000, 
        taxes: 20000, 
        marketing: 15000,
        software: 3000,
        other: 5000 
    };
    
    const getMonthlyCosts = () => Object.values(costStructure).reduce((a, b) => a + b, 0);

    function calculateFinancials(investment, rentalsPerDay, avgCheck) {
        const workingDaysPerMonth = 24;
        const monthlyRevenue = rentalsPerDay * avgCheck * workingDaysPerMonth;
        const monthlyCosts = getMonthlyCosts();
        const monthlyProfit = monthlyRevenue - monthlyCosts;

        const results = {
            monthlyRevenue,
            monthlyCosts,
            monthlyProfit,
            revenueHistory: [],
            costHistory: [],
            profitHistory: [],
            cumulativeProfitHistory: [],
            paybackMonths: 0,
        };

        let cumulativeProfit = -investment;
        for (let month = 1; month <= 24; month++) {
            let currentMonthRevenue = monthlyRevenue;
            if (month <= 3) currentMonthRevenue *= 0.7; 
            if (month > 3 && month <= 6) currentMonthRevenue *= 0.9;
            if (month > 12) currentMonthRevenue *= 1.1; 

            const currentMonthProfit = currentMonthRevenue - monthlyCosts;
            cumulativeProfit += currentMonthProfit;
            
            results.revenueHistory.push(currentMonthRevenue);
            results.costHistory.push(monthlyCosts);
            results.profitHistory.push(currentMonthProfit);
            results.cumulativeProfitHistory.push(cumulativeProfit);

            if (cumulativeProfit > 0 && results.paybackMonths === 0) {
                const prevCumulativeProfit = results.cumulativeProfitHistory[month - 2] || -investment;
                const profitInPaybackMonth = currentMonthProfit;
                results.paybackMonths = (month - 1) + (-prevCumulativeProfit / profitInPaybackMonth);
            }
        }
        
        if (results.paybackMonths === 0) results.paybackMonths = 25;

        return results;
    }

    function updateUI() {
        const investment = parseInt(initialInvestmentSlider.value);
        const rentalsPerDay = parseInt(avgRentalsPerDaySlider.value);
        const avgCheck = parseInt(avgCheckSlider.value);

        initialInvestmentValue.textContent = formatCurrency(investment);
        avgRentalsPerDayValue.textContent = rentalsPerDay;
        avgCheckValue.textContent = formatCurrency(avgCheck);
        summaryInvest.textContent = formatCurrency(investment);

        const data = calculateFinancials(investment, rentalsPerDay, avgCheck);

        const totalRevenueYear1 = data.revenueHistory.slice(0, 12).reduce((a, b) => a + b, 0);
        const netProfitYear1 = data.profitHistory.slice(0, 12).reduce((a, b) => a + b, 0);
        const payback = data.paybackMonths > 24 ? '> 24' : Math.ceil(data.paybackMonths);

        totalRevenueEl.textContent = `${formatCurrency(totalRevenueYear1)} ₽`;
        netProfitEl.textContent = `${formatCurrency(netProfitYear1)} ₽`;
        paybackPeriodEl.textContent = `${payback} мес.`;
        summaryPayback.textContent = payback;

        updateFinancialChart(data);
    }
    
    function createInvestmentChart() {
        const ctx = document.getElementById('investmentChart').getContext('2d');
        const investmentData = {
            labels: ['Закупка инструмента', 'Аренда помещения (2 мес)', 'Ремонт и мебель', 'Реклама', 'Регистрация и прочее'],
            datasets: [{
                label: 'Структура инвестиций',
                data: [500000, 80000, 120000, 100000, 50000],
                backgroundColor: ['#4A90E2', '#50E3C2', '#F5A623', '#F8E71C', '#BD10E0'],
                borderColor: '#FFFFFF',
                borderWidth: 2
            }]
        };
        investmentChart = new Chart(ctx, {
            type: 'doughnut',
            data: investmentData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed !== null) {
                                    label += new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'RUB' }).format(context.parsed);
                                }
                                return label;
                            }
                        }
                    }
                }
            },
        });
    }

    function createFinancialChart() {
        const ctx = document.getElementById('financialChart').getContext('2d');
        financialChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Array.from({length: 24}, (_, i) => `Мес ${i + 1}`),
                datasets: [
                    {
                        label: 'Выручка',
                        data: [],
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        order: 2,
                    },
                    {
                        label: 'Расходы',
                        data: [],
                        backgroundColor: 'rgba(255, 99, 132, 0.6)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1,
                        order: 2,
                    },
                    {
                        label: 'Накопленная прибыль',
                        data: [],
                        type: 'line',
                        borderColor: '#C5A07A',
                        backgroundColor: 'transparent',
                        yAxisID: 'y1',
                        tension: 0.1,
                        order: 1,
                        pointRadius: 2,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Сумма, ₽' }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        grid: {
                            drawOnChartArea: false,
                        },
                        title: { display: true, text: 'Накопленная прибыль, ₽' }
                    }
                },
                plugins: {
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                    }
                }
            }
        });
    }

    function updateFinancialChart(data) {
        financialChart.data.datasets[0].data = data.revenueHistory;
        financialChart.data.datasets[1].data = data.costHistory;
        financialChart.data.datasets[2].data = data.cumulativeProfitHistory;
        financialChart.update();
    }
    
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const target = tab.dataset.tab;

            tabs.forEach(t => {
                t.classList.remove('tab-active');
                t.classList.add('tab-inactive');
            });
            tab.classList.add('tab-active');
            tab.classList.remove('tab-inactive');

            sections.forEach(section => {
                if (section.id === target) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
        });
    });

    initialInvestmentSlider.addEventListener('input', updateUI);
    avgRentalsPerDaySlider.addEventListener('input', updateUI);
    avgCheckSlider.addEventListener('input', updateUI);

    createInvestmentChart();
    createFinancialChart();
    updateUI();
});
</script>
</body>
</html>
